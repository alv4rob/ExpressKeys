# Express Keys
<p align="center">
<img src="imagenes/logo.png" alt="Logo" width="600" height="600">

# Descripci√≥n de la web üåê
ExpressKeys consiste en una web de compra de "keys" de videojuegos para las diferentes plataformas online del mercado. En ella el cliente puede buscar los diferentes t√≠tulos disponibles utilizando diferentes herramientas como por ejemplo un sistema de filtrado por categor√≠as, por precio, por plataforma online, etc... para posteriormente comprarlo y recibir su c√≥digo para canjearlo.


# Entidades üóØ
 * Clientes: Usuarios del sistema que compran las keys en la p√°gina web.
 * Administradores: Usuario o usuarios que se encargan de a√±adir o eliminar productos del catalogo de la tienda.
 * Producto: Son las keys de los videojuegos que se muestran en la tienda y el usuario puede comprar.
 * Carrito de la compra: Los usuarios pueden a√±adir una o varias keys a una cesta de la compra antes de adquirirlas.
 * Valoraciones: Tras comprar una key un usuario puede dejar una puntuacion a la compra o revisar la valoraci√≥n de otros productos,

# Parte p√∫blica üîì
* Busqueda de videojuegos
* Filtrar cat√°logo
* Comprar keys
* Logearse/Registrarse 

# Parte privada üîê
* A√±adir/Eliminar productos del catalogo
* Dar de baja/alta a usuarios
* Consultar informaci√≥n de usuarios.

# Servicio interno üñ•
El servicio interno de Express Keys es el encargado de recoger la lista de productos de una compra para el env√≠o por correo electr√≥nico del ticket de compra con los productos, sus keys y precios a la direcci√≥n de correo del cliente. 

La forma que tiene de comunicarse con la aplicaci√≥n web es mediante colas de mensajes a trav√©s del broker de mensajer√≠a RabbitMQ.

En el momento de realizar una compra, la web env√≠a un mensaje formado por el ticket de compra y la direcci√≥n del cliente a una cola del broker donde es consumido al momento por el SI, que permanece a la escucha de los mensajes que entran en la cola. Una vez recibido el mensaje, el SI separa el mensaje para obtener el ticket y la direcci√≥n, formula el correo, lo env√≠a a la direcci√≥n del cliente y vuelve a permanecer atento a futuras peticiones hasta que se detenga su ejecuci√≥n o pierda la conexi√≥n con RabbitMQ.

# Integrantes üë• 

* Sergio Garc√≠a Rosell [s.garciaro.2017@alumnos.urjc.es] https://github.com/SergioGr8
* √Ålvaro Barrio Luquero [a.barrio.2017@alumnos.urjc.es] https://github.com/alv4rob
* Nerfi Salim Perello [n.salim.2017@alumnos.urjc.es] https://github.com/nerf7

# Capturas de pantalla 
* P√°gina principal: Como p√°gina principal, se muestra tanto el cat√°logo completo de productos junto a los filtros de b√∫squeda, adem√°s de los enlaces de registro e inicio de sesi√≥n.
<p align="center">
<img src="imagenes/PaginaPrincipal.png">
  
* Registro: La p√°gina de registro de usuarios incluye los campos para introducir un nombre de usuario, una contrase√±a y un correo electr√≥nico, los campos que conforman a un usuario.
<p align="center">
<img src="imagenes/Registro.png">

* Usuario registrado: Pantalla de aviso de que un nuevo usuario ha sido registrado. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/UsuarioRegistrado.png">
  
* Inicio de sesi√≥n: Se trata de la pantalla que recibe los datos de login de un usuario para que pueda iniciar sesi√≥n.
<p align="center">
<img src="imagenes/InicioDeSesion.png">

* P√°gina principal (logged): P√°gina principal una vez se ha iniciado sesi√≥n correctamente. Es como la pantalla P√°gina principal, pero permite acceder a la P√°gina del carrito y a la P√°gina de usuario. Para administradores, permite acceder a la pantalla Admin.
<p align="center">
<img src="imagenes/PaginaPrincipalLogged.png">

* Login error: Pantalla de aviso de que el usuario y contrase√±a introducidos no pertenecen a ning√∫n usuario registrado. Permite volver a la pantlla de Inicio de sesi√≥n.
<p align="center">
<img src="imagenes/LoginError.png">

* Admin: Pantalla exclusiva para administradores que permite mostrar la pantalla de Lista de usuarios, Nuevo producto o volver a la P√°gina principal (logged).
<p align="center">
<img src="imagenes/Admin.png">

* Perfil: Pantalla que muestra los datos del usuario en la sesi√≥n.
<p align="center">
<img src="imagenes/Perfil.png">
  
* Lista de usuarios: Como opci√≥n para los administradores, contiene la lista de los usuarios registrados actualmente y sus roles. Permite acceder a la p√°gina de cada usuario o volver a la P√°gina principal (logged).
<p align="center">
<img src="imagenes/ListaDeUsuarios.png">
  
* P√°gina de usuario: P√°gina exclusiva de administradores que muestra los datos de un usuario y da la opci√≥n de eliminarlo de la base de datos.
<p align="center">
<img src="imagenes/PaginaDeUsuario.png">
  
* Usuario eliminado: Pantalla de aviso de que un usuario ha sido eliminado. Lleva de vuelta a la Lista de usuarios.
<p align="center">
<img src="imagenes/ClienteEliminado.png">
  
* Nuevo producto: Se trata de la p√°gina de inserci√≥n de usuarios al cat√°logo. Incluye los campos para introducir una lista de keys, un t√≠tulo, un precio, una plataforma y una categor√≠a, los campos que conforman un producto.
<p align="center">
<img src="imagenes/NuevoProducto.png">
  
* Producto guardado: Pantalla de aviso de que un nuevo producto ha sido guardado en la base de datos. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/ProductoGuardado.png">
  
* P√°gina de producto: Muestra la informaci√≥n de un producto y da la opci√≥n de a√±adirlo al carrito, dejar una valoraci√≥n o volver a la p√°gina principal. Como opci√≥n para los administradores, est√° la posibilidad de eliminar el producto de la base de datos y poder ver las keys que quedan del producto.
<p align="center">
<img src="imagenes/PaginaDeProducto.png">
  
* A√±adido al carrito: Pantalla de aviso de que un producto ha sido a√±adido al carrito. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/A√±adidoAlCarrito.png">
  
* No √±adido al carrito: Pantalla de aviso de que un producto no ha sido a√±adido al carrito. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/NoA√±adidoAlCarrito.png">

* Producto eliminado: Pantalla de aviso de que un producto ha sido eliminado de la base de datos. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/ProductoEliminado.png">
  
* Introducci√≥n de valoraci√≥n: Pantalla en la que a√±adir el nombre y contenido de una valoraci√≥n para un producto.
<p align="center">
<img src="imagenes/IntroduccionDeValoraci√≥n.png"> 

* Valoraci√≥n enviada: Pantalla de aviso de que una valoraci√≥n ha sido registrada. Lleva de vuelta a la P√°gina de producto.
<p align="center">
<img src="imagenes/Valoraci√≥nEnviada.png">
  
* P√°gina del carrito: Pantalla que contiene los productos que se encuentran en el carrito en un momento dado junto a la suma total a pagar. Permite volver a la P√°gina principal o acceder a comprar.
<p align="center">
<img src="imagenes/PaginaDelCarrito.png">
  
* Compra finalizada: Pantalla de aviso de que la compra ha sido completada. Se adjunta un recibo con los productos comprados y su key. Lleva de vuelta a la P√°gina principal.
<p align="center">
<img src="imagenes/CompraFinalizada.png">

* Error compra: Pantalla de aviso de que ocurri√≥ un error al procesar la compra. El carrito se mantendr√° como estaba. Lleva de vuelta a la P√°gina principal (logged).
<p align="center">
<img src="imagenes/CompraFinalizada.png">

# Diagrama de navegaci√≥n

Una vez vista cada una de las pantallas, a continuaci√≥n se adjunta el diagrama de navegaci√≥n de las mismas:
<p align="center">
<img src="imagenes/DiagramaDeNavegacion.jpg">
  
# Diagrama Entidad Relaci√≥n
<p align="center">
<img src="imagenes/DiagramaEntidadRelacion2.PNG">

# Diagrama UML
Adjuntamos una imagen con el diagrama UML (actualizado):
<p align="center">
<img src="imagenes/DiagramaUML.png">

# Diagrama de Clases y templates
Adjuntamos aqu√≠ el diagrama de clases y templates:
<p align="center">
<img src="imagenes/DiagramaDeClasesTemplates.jpg">

# Instrucciones de instalaci√≥n 

Para desplegar la aplicaci√≥n sobre Windows 10, adem√°s de acceso a internet, se necesita instalar antes en la m√°quina:

- Java 8
- RabbitMQ 3.8.11
- MySQL 8.0.23

## Java 8

Java 8 es la versi√≥n de Java utilizada tanto por la aplicaci√≥n web como por el servicio interno.

Pasos para instalar Java 8:

1¬∫. Ve a la p√°gina de descarga https://www.java.com/es/download/windows_manual.jsp , elige el archivo de instalaci√≥n ‚ÄúWindows En l√≠nea‚Äù y desc√°rgalo.

2¬∫. Ejecuta el archivo reci√©n descargado y selecciona ‚ÄúInstalar‚Äù. Una vez finalizada la instalaci√≥n, selecciona ‚ÄúCerrar‚Äù.

## RabbitMQ 3.8.11

RabbitMQ es el broker de mensajer√≠a que utiliza la aplicaci√≥n web para comunicarse con el servicio interno. Para facilitar la instalaci√≥n de RabbitMQ, se har√° v√≠a Chocolatey.

Pasos para instalar Chocolatey:

1¬∫. Abre Windows PowerShell como administrador.

2¬∫. Ejecuta el siguiente comando para evitar la pol√≠tica de ejecuci√≥n y confirma con ‚ÄúS‚Äù.
```bash
Set-ExecutionPolicy AllSigned
```

3¬∫. Ejecuta el siguiente comando para descargar e instalar Chocolatey.
```bash
Set-ExecutionPolicy Bypass -Scope Process -Force; [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))
```

Pasos para instalar RabbitMQ:

1¬∫. Abre Windows PowerShell como administrador.

2¬∫. Ejecuta el siguiente comando para descargar e instalar RabbitMQ y confirma con ‚ÄúY‚Äù las veces necesarias. Permite el acceso de red a las aplicaciones que lo soliciten a trav√©s del Firewall de Windows durante la instalaci√≥n. 
```bash
choco install rabbitmq
```

## MySQL 8.0.23

MySQL es la base de datos utilizada por la aplicaci√≥n web.

Para instalar MySQL y todas sus herramientas correctamente primero hay que instalar Microsot Visual C++ 2019 Redistributable Package (x64), para instarlarlo se realizaran los siguientes pasos:

1¬∫. Entrar en este enlace para descargar Microsoft Visual C++ 2019 : https://support.microsoft.com/es-es/topic/descargas-m%C3%A1s-recientes-compatibles-de-visual-c-2647da03-1eea-4433-9aff-95f26a218cc0

2¬∫. Ir al apartado de Visual Studio 2015,2017,2019 y clicar en el enlace. 

3¬∫. Abrir el ejecutable, aceptar los t√©rminos y condiciones e instalar.

Una vez hecho esto procedemos a explicar los pasos para instalar MySQL:

1¬∫. Entrar en este enlace para descargar la base de datos: https://dev.mysql.com/downloads/

2¬∫. Clicar en MySQLInstaller for Windows.

3¬∫. Descargar la versi√≥n MySQL Installer 8.0.23 (mysql-installer-community-8.0.23.0.msi) y pulsar en la siguiente ventana "No thanks,just start tmy download".

4¬∫. Abrir el ejecutable. En la pesta√±a de "Choosing a Setup Type" seleccionar la opci√≥n que ponga ‚ÄúCustom‚Äù y dale a ‚ÄúNext‚Äù.

5¬∫. A√±ade los productos MySQL Server 8.0.23, Connector/J 8.0.23 y MySQL Workbench 8.0.23, dale a ‚ÄúNext‚Äù y despu√©s a ‚ÄúExecute‚Äù para instalar los productos. Cuando termine la instalaci√≥n, dale a ‚ÄúNext‚Äù dos veces m√°s.

6¬∫. En la pesta√±a ‚ÄúType and Networking‚Äù deja todo como est√° y dale a ‚ÄúNext‚Äù.

7¬∫. En la pesta√±a ‚ÄúAuthentication Method‚Äù deja todo como est√° y dale a ‚ÄúNext‚Äù.

8¬∫. En la pesta√±a ‚ÄúAccounts and Roles‚Äù, escribe ‚Äúpassword‚Äù como Root Password y dale a ‚ÄúNext‚Äù.

9¬∫. En la pesta√±a ‚ÄúWindows Service‚Äù deja todo como est√° y dale a ‚ÄúNext‚Äù y despu√©s a ‚ÄúExecute‚Äù. Cuando termine, dale a ‚ÄúFinish‚Äù y despu√©s a ‚ÄúNext‚Äù. Finalmente, dale a ‚ÄúFinish‚Äù para terminar con la instalaci√≥n y la configuraci√≥n.

10¬∫. Abre la aplicaci√≥n MySQL Workbench y accede a Local instance MySQL80 con la contrase√±a ‚Äúpassword‚Äù.

11¬∫. Elige ‚ÄúCreate a new schema in the connected server‚Äù, n√≥mbralo ‚Äútrabajodad‚Äù y dale a ‚ÄúApply‚Äù primero una vez y luego otra, y despu√©s a ‚ÄúFinish‚Äù.

## Despliegue de la aplicaci√≥n

Una vez instaladas las aplicaciones necesarias, podemos desplegar la aplicaci√≥n.

Pasos para desplegar la aplicaci√≥n:

1¬∫. Descarga los ejecutables xkeys_web-0.0.1-SNAPSHOT.jar y xkeys_si-0.0.1-SNAPSHOT.jar del repositorio.

2¬∫. Abre la consola de comandos (S√≠mbolo del sistema) como administrador.

3¬∫. Comprueba que se est√° ejecutando el servicio RabbitMQ. Puedes ejecutar el siguiente comando y se iniciar√° el servicio o indicar√° que ya ha sido iniciado.
```bash
net start RabbitMQ
```

4¬∫. Comprueba que se est√° ejecutando el servicio MySQL80. Puedes ejecutar el siguiente comando y se iniciar√° el servicio o indicar√° que ya ha sido iniciado.
```bash
net start MySQL80
```

5¬∫. Mu√©vete al directorio donde se encuentre xkeys_web-0.0.1-SNAPSHOT.jar y ejecuta el siguiente comando para iniciar la aplicaci√≥n web. Permite el acceso de red si se solicita a trav√©s del Firewall de Windows.
```bash
java -jar xkeys_web-0.0.1-SNAPSHOT.jar
```

6¬∫. Abre otra consola de comandos, mu√©vete al directorio donde se encuentre xkeys_si-0.0.1-SNAPSHOT.jar y ejecuta el siguiente comando para iniciar el servicio interno.
```bash
java -jar xkeys_si-0.0.1-SNAPSHOT.jar
```

7¬∫. Acceder a la web a trav√©s del navegador en https://localhost:8443/ .

# Diagrama de infraestructura
Adjuntamos el diagrama de la infrestructura en Docker con los componentes que forman la aplicaci√≥n y la relaci√≥n entre ellos.
<p align="center">
<img src="imagenes/DiagramaInfraestructura.jpg">
  
  
# Video explicativo de la p√°gina web
En este video se puede ver el perfecto funcionamiento y como se comporta la aplicaci√≥n en ciertas situaciones forzadas como ejemplo. <br/> 
<p align="center">
[![Express Keys](https://img.youtube.com/vi/K3_CQ9RSMkE/maxresdefault.jpg)](https://youtu.be/K3_CQ9RSMkE)
